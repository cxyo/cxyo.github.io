<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基金温度表</title>
    <link rel="stylesheet" href="css/style.css?v=31">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- 第一行：标题 -->
        <header class="header">
            <h1>📊 基金温度表</h1>
        </header>
        
        <!-- 图表区域 -->
        <div class="chart-section" style="display: none; background-color: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); position: sticky; top: 20px; z-index: 1000;">
            <h2 id="chartTypeTitle" style="color: #333; margin-bottom: 15px;">📈 历史图表</h2>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div id="chartTitle" style="font-size: 16px; font-weight: bold; color: #333;"></div>
                <div>
                    <div style="margin-bottom: 10px;">选择时间范围：</div>
                    <div class="time-range-buttons">
                        <button onclick="changeChartDays(5)" class="time-btn">5天</button>
                        <button onclick="changeChartDays(10)" class="time-btn">10天</button>
                        <button onclick="changeChartDays(15)" class="time-btn">15天</button>
                        <button onclick="changeChartDays(20)" class="time-btn active">20天</button>
                    </div>
                </div>
                <button onclick="closeChart()" style="padding: 8px 16px; background-color: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s;">关闭图表</button>
            </div>
            <div id="temperatureChart" style="width: 100%; height: 500px; background-color: white; border-radius: 8px; padding: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);"></div>
        </div>

        <!-- 第二行：日期 -->
        <div class="date-row">
            <div class="date-left">📅 数据日期: <span id="dataDate">加载中...</span></div>
            <div class="date-center"><span id="avgStar"></span>温度星级: <span id="starValue">--</span>星</div>
            <div class="copyright">Made By <span class="brand-name">第一网络</span></div>
        </div>

        <!-- 温度星级说明 -->
        <div class="star-description">
            <!-- 第一行 -->
            <div class="star-desc-row">
                <!-- 第一列：星级说明 -->
                <div class="star-desc-column star-desc-left">
                    <div class="star-desc-item"><span class="star-num">1星</span>：市场很贵，不易入市</div>
                    <div class="star-desc-item"><span class="star-num">2星</span>：市场偏贵，分批卖出</div>
                    <div class="star-desc-item"><span class="star-num">3星</span>：市场正常，正常持有</div>
                    <div class="star-desc-item"><span class="star-num">4星</span>：市场便宜，可以投资</div>
                    <div class="star-desc-item"><span class="star-num">5星</span>：市场最便宜，投资机会最大</div>
                    <div class="star-desc-item"><span class="star-num">6星</span>：历史上还没有出现过</div>
                </div>
                <!-- 第二列：基金组合 -->
                <div class="star-desc-column star-desc-center-left">
                    <div class="fund-combo-container">
                        <div class="fund-combo-title">《定投：组合法》</div>
                        <div class="fund-combo-text">大盘 (占比：20%, 定投：1支)</div>
                        <div class="fund-combo-text">小盘 (占比：20%, 定投：1支)</div>
                        <div class="fund-combo-text">策略 (占比：10%, 定投：2支)</div>
                        <div class="fund-combo-text">行业 (占比：10%, 定投：2支)</div>
                        <div class="fund-combo-text">主题 (占比：10%, 定投：2支)</div>
                        <div class="fund-combo-text">海外 (占比：10%, 定投：1支)</div>
                        <div class="fund-combo-text">债券 (占比：20%, 定投：2支)</div>
                    </div>
                </div>
            </div>
            <!-- 第二行 -->
            <div class="star-desc-row">
                <!-- 第三列：注意事项 -->
                <div class="star-desc-column star-desc-center-right">
                    <div class="disclaimer-text">估值温度数据来源于网络，</div>
                    <div class="disclaimer-text">仅供学习参考，</div>
                    <div class="disclaimer-text">不代表任何投资建议！</div>
                </div>
                <!-- 第四列：公众号二维码 -->
                <div class="star-desc-column star-desc-right">
                    <img src="images/qrcode.png" alt="公众号二维码" class="qrcode-img">
                </div>
            </div>
        </div>

        <!-- 股市晴雨表、中证全指EPV、四大魔盒和指数添加 -->
        <div class="stock-weather-section">
            <h2 class="stock-weather-title">一、股市晴雨表</h2>
            <div class="stock-weather-table-container">
                <table class="stock-weather-table">
                    <thead>
                        <tr>
                            <th>指数</th>
                            <th>PE温度&lt;50%</th>
                            <th>PB温度&lt;20%</th>
                            <th>建议可否入市</th>
                            <th>建议</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>大盘</td>
                            <td>42.16%</td>
                            <td>30.38%</td>
                            <td class="not-recommended" rowspan="2">不宜入市</td>
                            <td rowspan="2">烟蒂股</td>
                        </tr>
                        <tr>
                            <td>小盘</td>
                            <td>49.36%</td>
                            <td>29.60%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h2 class="stock-weather-title">二、中证全指EPV、四大魔盒</h2>
            <div class="epv-magic-box-container">
                <!-- 中证全指EPV部分 -->
                <div class="epv-section">
                    <h3 style="text-align: center; margin-bottom: 10px;">2.1、中证全指EPV</h3>
                    <table class="stock-weather-table epv-table">
                        <thead>
                            <tr>
                                <th>PE_TTM</th>
                                <th>10年期国债收益</th>
                                <th>EPV</th>
                                <th>建议</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="vertical-align: middle;">8.53%</td>
                                <td style="vertical-align: middle;">1.839%</td>
                                <td style="vertical-align: middle;">4.641014877</td>
                                <td style="vertical-align: middle;">黄金坑</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 10px; font-weight: bold; color: #ff0000; text-align: center; flex-grow: 1; display: flex; align-items: flex-start; justify-content: center;">
                        黄金坑&gt;2.5≥白银坑≥2≥青铜坑≥1.5≥废坑
                    </div>
                </div>
                
                <!-- 四大魔盒部分 -->
                <div class="magic-box-section">
                    <h3 style="text-align: center; margin-bottom: 10px;">2.2、四大魔盒</h3>
                    <table class="stock-weather-table magic-box-table">
                        <thead>
                            <tr>
                                <th>魔盒</th>
                                <th>当前值</th>
                                <th>开启标准</th>
                                <th>是否开启</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>中证800PE</td>
                                <td>94.28%</td>
                                <td>&gt;70%</td>
                                <td rowspan="2" style="vertical-align: middle;">关闭</td>
                            </tr>
                            <tr>
                                <td>中证800PB</td>
                                <td>67.42%</td>
                                <td>&gt;70%</td>
                            </tr>
                            <tr>
                                <td>股市吸引力</td>
                                <td>4.05%</td>
                                <td>&lt;1.5%</td>
                                <td>关闭</td>
                            </tr>
                            <tr>
                                <td>巴菲特指数</td>
                                <td>96.23%</td>
                                <td>&gt;100%</td>
                                <td>关闭</td>
                            </tr>
                            <tr>
                                <td>七日换手率</td>
                                <td>28.62%</td>
                                <td>&gt;10%</td>
                                <td>开启</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 10px; font-weight: bold; color: #ff0000; text-align: center; flex-grow: 1; display: flex; align-items: flex-start; justify-content: center;">
                        四大魔盒全开时，是股灾的开始！！！
                    </div>
                </div>
            </div>
            
            <!-- 指数添加 -->
            <h2 class="stock-weather-title">三、指数添加</h2>
            <div class="search-box">
                <input type="text" id="searchKeyword" placeholder="请输入指数代码或名称（如：000016、上证50、银行）">
                <button onclick="searchIndex()">搜索</button>
            </div>
            
            <!-- 搜索结果选择 -->
            <div id="searchResults" class="search-results" style="display: none;">
                <p>找到多个匹配结果，请选择：</p>
                <div id="resultsList" class="results-list"></div>
            </div>
            
            <!-- 类别选择 -->
            <div id="categorySelect" class="category-select" style="display: none;">
                <p>请选择类别类型：</p>
                <div class="category-buttons">
                    <button class="category-btn" data-category="B" onclick="selectCategory('B')">B - 大盘 (20%, 1支)</button>
                    <button class="category-btn" data-category="C" onclick="selectCategory('C')">C - 小盘 (20%, 1支)</button>
                    <button class="category-btn" data-category="D" onclick="selectCategory('D')">D - 策略 (10%, 2支)</button>
                    <button class="category-btn" data-category="E" onclick="selectCategory('E')">E - 行业 (10%, 2支)</button>
                    <button class="category-btn" data-category="F" onclick="selectCategory('F')">F - 主题 (10%, 2支)</button>
                    <button class="category-btn" data-category="G" onclick="selectCategory('G')">G - 海外 (10%, 1支)</button>
                    <button class="category-btn" data-category="H" onclick="selectCategory('H')">H - 债券 (20%, 2支)</button>
                </div>
                <button class="add-btn" onclick="addToFundTable()">添加到基金温度</button>
            </div>
            
            <!-- 基金温度 -->
            <h2 class="stock-weather-title">四、基金温度</h2>
            <div class="temperature-section">
                <div class="table-container">
                    <table id="fundTable">
                        <thead>
                            <tr>
                                <th>类型</th>
                                <th>指数代码</th>
                                <th>指数名称</th>
                                <th>基金温度</th>
                                <th>今年涨跌</th>
                                <th>上一日涨跌</th>
                                <th>上两日涨跌</th>
                                <th>场内代码</th>
                                <th>场外代码</th>
                                <th>关注度</th>
                            </tr>
                        </thead>
                        <tbody id="fundTableBody">
                        </tbody>
                    </table>
                </div>
                
                <!-- 配置管理按钮 -->
                <div class="config-buttons">
                    <button onclick="exportCustomConfig()" class="config-btn export-btn">📥 导出配置</button>
                    <button onclick="clearCustomConfig()" class="config-btn clear-btn">🗑️ 清除配置</button>
                    <label class="config-btn import-btn">
                        📤 导入配置
                        <input type="file" id="configFileInput" accept=".json" style="display: none;" onchange="importCustomConfig(this)">
                    </label>
                </div>
            </div>
        </div>

        <!-- 导入配置说明 -->
        <div class="import-section">
            <h3>📋 配置导入说明</h3>
            <p>导入配置文件后，指数数据会立即显示在基金温度表中。</p>
            <div class="import-template">
                <h4>配置文件格式（JSON）：</h4>
                <pre>{
  "B": ["399006", "399550"],
  "C": ["399673", "000852"],
  "D": ["399348", "399701"],
  "E": ["399807", "399396"],
  "F": ["930653", "399997"],
  "G": ["HSCGSI", "HSTECH"]
}</pre>
            </div>
        </div>

        <!-- CSV数据上传区域 -->
        <div class="csv-upload-section">
            <h3>📤 数据更新</h3>
            <p>上传最新的基金温度CSV文件，系统将自动以当天日期命名</p>
            <div class="csv-upload-row">
                <div class="csv-upload-box">
                    <label class="csv-upload-btn">
                        📁 选择CSV文件
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCSVUpload(this)">
                    </label>
                    <span id="csvFileName" class="csv-file-name">未选择文件</span>
                </div>
            </div>
            <div id="csvUploadStatus" class="csv-upload-status"></div>
        </div>

        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p>数据加载中...</p>
        </div>
    </div>

    <script src="js/app.js?v=23"></script>
</body>
</html>